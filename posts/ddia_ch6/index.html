<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> DDIA Notes Ch.6: Partitioning | Christian&#39;s Dev Blog</title>
  <link rel = 'canonical' href = 'http://callim105.github.io/posts/ddia_ch6/'>
  <meta name="description" content="Welcome to my brain dump. Technical musings and miscellaneous thoughts.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="DDIA Notes Ch.6: Partitioning" />
<meta property="og:description" content="Ch 6: Partitioning Note: These are my notes from reading chapter 6 of Designing Data Intensive applications.
For large datasets, or very high query throughput, we need to break the data up into partitions, also known as sharding.
 In effect, each partition is a small database of its own.  Partitioning and Replication Basically, you can use both partitioning and replication together to have high availability. You can have copies of each partition stored on multiple nodes." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://callim105.github.io/posts/ddia_ch6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-10T21:26:38-05:00" />
<meta property="article:modified_time" content="2021-08-10T21:26:38-05:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="DDIA Notes Ch.6: Partitioning"/>
<meta name="twitter:description" content="Ch 6: Partitioning Note: These are my notes from reading chapter 6 of Designing Data Intensive applications.
For large datasets, or very high query throughput, we need to break the data up into partitions, also known as sharding.
 In effect, each partition is a small database of its own.  Partitioning and Replication Basically, you can use both partitioning and replication together to have high availability. You can have copies of each partition stored on multiple nodes."/>

  
  
    
  
  
  <link rel="stylesheet" href="http://callim105.github.io/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css" integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N&#43;XoIuZg=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="http://callim105.github.io/images/favicon.ico" />

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" http://callim105.github.io/posts/invert_binary_tree/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f&text=DDIA%20Notes%20Ch.6%3a%20Partitioning" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f&title=DDIA%20Notes%20Ch.6%3a%20Partitioning" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f&is_video=false&description=DDIA%20Notes%20Ch.6%3a%20Partitioning" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=DDIA%20Notes%20Ch.6%3a%20Partitioning&body=Check out this article: http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f&title=DDIA%20Notes%20Ch.6%3a%20Partitioning" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f&title=DDIA%20Notes%20Ch.6%3a%20Partitioning" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f&name=DDIA%20Notes%20Ch.6%3a%20Partitioning&description=Ch%206%3a%20Partitioning%20Note%3a%20These%20are%20my%20notes%20from%20reading%20chapter%206%20of%20Designing%20Data%20Intensive%20applications.%0aFor%20large%20datasets%2c%20or%20very%20high%20query%20throughput%2c%20we%20need%20to%20break%20the%20data%20up%20into%20partitions%2c%20also%20known%20as%20sharding.%0a%20In%20effect%2c%20each%20partition%20is%20a%20small%20database%20of%20its%20own.%20%20Partitioning%20and%20Replication%20Basically%2c%20you%20can%20use%20both%20partitioning%20and%20replication%20together%20to%20have%20high%20availability.%20You%20can%20have%20copies%20of%20each%20partition%20stored%20on%20multiple%20nodes." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f&t=DDIA%20Notes%20Ch.6%3a%20Partitioning" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#partitioning-and-replication">Partitioning and Replication</a></li>
    <li><a href="#partitioning-of-key-value-data">Partitioning of Key-Value data</a>
      <ul>
        <li><a href="#partitioning-by-key-range">Partitioning by Key Range</a></li>
        <li><a href="#partitioning-by-hash-of-key">Partitioning by Hash of Key</a></li>
        <li><a href="#skewed-workloads-and-relieving-hot-spots">Skewed Workloads and Relieving Hot Spots</a></li>
        <li><a href="#partitioning-and-secondary-index">Partitioning and Secondary Index</a></li>
      </ul>
    </li>
    <li><a href="#rebalancing-partitions">Rebalancing Partitions</a>
      <ul>
        <li><a href="#strategies-for-rebalancing">Strategies for Rebalancing</a></li>
      </ul>
    </li>
    <li><a href="#request-routing">Request Routing</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        DDIA Notes Ch.6: Partitioning
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2021-08-10 21:26:38 -0500 CDT" itemprop="datePublished">2021-08-10</time>
          
        </div>
        
        
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/system_design" rel="tag">system_design</a>
            
        </div>
        
      </div>
    </header>

  
    <div class="content" itemprop="articleBody">
      <h1 id="ch-6-partitioning">Ch 6: Partitioning</h1>
<p>Note: These are my notes from reading chapter 6 of Designing Data Intensive
applications.</p>
<p>For large datasets, or very high query throughput, we need to break the data
up into partitions, also known as sharding.</p>
<ul>
<li>In effect, each partition is a small database of its own.</li>
</ul>
<h2 id="partitioning-and-replication">Partitioning and Replication</h2>
<p>Basically, you can use both partitioning and replication together to have
high availability. You can have copies of each partition stored on multiple
nodes. And a node can store more than one partition.</p>
<h2 id="partitioning-of-key-value-data">Partitioning of Key-Value data</h2>
<p>The goal of partitioning is to evenly spread out the work among your nodes.
Something to look out for is hot spots, areas where lots of data is clustered
for some reason or other, and you end up getting bottlenecked.</p>
<h3 id="partitioning-by-key-range">Partitioning by Key Range</h3>
<p>An approach to partitioning is by separating your data into ranges.
For example if you have it indexed by letter keys, you could have groups like
A through F, and G through O. Then, when you need to find something it becomes
easy as long as your keys are in sorted order.</p>
<h3 id="partitioning-by-hash-of-key">Partitioning by Hash of Key</h3>
<p>Certain access patterns of the key-range partitioning method can lead to hot
spots. For ex: if the key is a timestamp, then the partitions correspond to
ranges of time, this can lead to hot spots if all the writes happen at the
same time. Because of this risk of skew and hot spots, many distributed
datastores use a hash function to determine the partition for a given key.</p>
<p>A good hash function takes skewed data and makes it uniformly distributed.</p>
<p>Once you have a good hash function for keys, you can assign each partition a
range of hashes rather than a range of keys.</p>
<h3 id="skewed-workloads-and-relieving-hot-spots">Skewed Workloads and Relieving Hot Spots</h3>
<p>Sometimes having a good hash function isn&rsquo;t enough, because for example a hot
source could produce hot spots with the same hash.
<strong>A simple technique is to add a random number to the beginning or end of the key.</strong></p>
<p>Just a two digit decimal random number would split the writes to the key evenly
across 100 different keys.</p>
<h3 id="partitioning-and-secondary-index">Partitioning and Secondary Index</h3>
<p>Partitioning becomes more complex if secondary indexes are involved.</p>
<p><em>What is a secondary index?</em></p>
<p>A secondary index usually doesn&rsquo;t identify a record uniquely, but rather is a
way of searching for occurrences of a particular value.
Find all actions by user 123, find all cars whose color is red, etc.</p>
<p><strong>Problem: They don&rsquo;t map nearly to partitions.</strong></p>
<p><strong>solution: Document-based partitioning and term-based partitioning</strong></p>
<h2 id="rebalancing-partitions">Rebalancing Partitions</h2>
<p>As your db grows and changes, data and requests need to be moved from one node to another.
The process of moving load around is called rebalancing.</p>
<h3 id="strategies-for-rebalancing">Strategies for Rebalancing</h3>
<p><strong>Hash mod N</strong>: Bad. Too costly, and moves data around unnecessarily</p>
<p><strong>Fixed number of partitions</strong>: Pretty good, create many more partitions than
there are nodes. The only thing that changes is the assignment of partitions to nodes.</p>
<p><strong>Dynamic partitioning:</strong> key range-partitioned databases create partitions
dynamically. When a partition grows to exceed a configured size, it is split
into two partitions so half the data ends up on each side.</p>
<p>An advantage is that the number of partitions adapts to the total data volume.
But while the dataset is small, all writes have to be processed by a single node while the other nodes sit idle.</p>
<p><strong>Have a fixed number of partitions per node.</strong></p>
<h2 id="request-routing">Request Routing</h2>
<p>This is an instance of a more general problem called <strong>service discovery.</strong> Few different approaches:</p>
<ul>
<li>Allow clients to contact any node</li>
<li>Send all requests from clients to a routing tier first</li>
<li>Require that clients be aware of the partitioning and the assignment of partitions to nodes.</li>
</ul>
<h2 id="summary">Summary</h2>
<p>Partitioning is necessary when you have a ton of data that storing and processing it on a single machine is not possible.</p>
<p><strong>Goal of partitioning:</strong> Spread the data and query load evenly across multiple machines and avoid hot spots (nodes with high load).</p>
<p><strong>Two main approaches to partitioning:</strong></p>
<ul>
<li><strong>Key range partitioning</strong></li>
<li>Hash partitioning</li>
</ul>
<p>A secondary index also needs to be partitioned. Two approaches to secondary index partitioning:</p>
<ul>
<li><strong>Document partitioned indexes (local indexes):</strong> secondary indexes are stored in the same partition as the primary key and value. Write can be to a single partition, but a read is heavy and requires a scatter/gather across all partitions.</li>
<li><strong>Term-partitioned indexes (global indexes):</strong> secondary indexes are partitioned separately. An entry in the secondary index may include records from all partitions of the primary key. Writes are heavier, but read can be from a single partition.</li>
</ul>

    </div>
  </article>

  
  





  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">Posts</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#partitioning-and-replication">Partitioning and Replication</a></li>
    <li><a href="#partitioning-of-key-value-data">Partitioning of Key-Value data</a>
      <ul>
        <li><a href="#partitioning-by-key-range">Partitioning by Key Range</a></li>
        <li><a href="#partitioning-by-hash-of-key">Partitioning by Hash of Key</a></li>
        <li><a href="#skewed-workloads-and-relieving-hot-spots">Skewed Workloads and Relieving Hot Spots</a></li>
        <li><a href="#partitioning-and-secondary-index">Partitioning and Secondary Index</a></li>
      </ul>
    </li>
    <li><a href="#rebalancing-partitions">Rebalancing Partitions</a>
      <ul>
        <li><a href="#strategies-for-rebalancing">Strategies for Rebalancing</a></li>
      </ul>
    </li>
    <li><a href="#request-routing">Request Routing</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
    </div>

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f&text=DDIA%20Notes%20Ch.6%3a%20Partitioning" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f&title=DDIA%20Notes%20Ch.6%3a%20Partitioning" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f&is_video=false&description=DDIA%20Notes%20Ch.6%3a%20Partitioning" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=DDIA%20Notes%20Ch.6%3a%20Partitioning&body=Check out this article: http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f&title=DDIA%20Notes%20Ch.6%3a%20Partitioning" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f&title=DDIA%20Notes%20Ch.6%3a%20Partitioning" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f&name=DDIA%20Notes%20Ch.6%3a%20Partitioning&description=Ch%206%3a%20Partitioning%20Note%3a%20These%20are%20my%20notes%20from%20reading%20chapter%206%20of%20Designing%20Data%20Intensive%20applications.%0aFor%20large%20datasets%2c%20or%20very%20high%20query%20throughput%2c%20we%20need%20to%20break%20the%20data%20up%20into%20partitions%2c%20also%20known%20as%20sharding.%0a%20In%20effect%2c%20each%20partition%20is%20a%20small%20database%20of%20its%20own.%20%20Partitioning%20and%20Replication%20Basically%2c%20you%20can%20use%20both%20partitioning%20and%20replication%20together%20to%20have%20high%20availability.%20You%20can%20have%20copies%20of%20each%20partition%20stored%20on%20multiple%20nodes." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2fcallim105.github.io%2fposts%2fddia_ch6%2f&t=DDIA%20Notes%20Ch.6%3a%20Partitioning" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  Christian&#39;s Dev Blog 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>



</html>
